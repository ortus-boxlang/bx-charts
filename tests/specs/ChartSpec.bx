
/**
 * BoxLang Charts Integration Tests
 */
class extends="testbox.system.BaseSpec"{

	/*********************************** LIFE CYCLE Methods ***********************************/

	/**
	 * executes before all suites+specs in the run() method
	 */
	function beforeAll(){
		// Setup test data
		variables.testData = {
			"jvmFreeMemory": 512,
			"jvmMaxMemory": 1024,
			"jvmTotalMemory": 768,
			"cacheHits": 150,
			"cacheMisses": 25,
			"cacheEvictions": 5,
			"cacheGarbageCollections": 2
		};
	}

	/**
	 * executes after all suites+specs in the run() method
	 */
	function afterAll(){

	}

	/*********************************** BDD SUITES ***********************************/

	function run( testResults, testBox ){
		describe( "BoxLang Charts Enhanced Features", () => {

			it( "can render a pie chart with axis titles and custom colors", () => {
				// This would typically use BoxLang's component rendering system
				// For now, we'll test the component structure and attributes

				var chartAttributes = {
					"title": "JVM Memory Usage",
					"chartwidth": 400,
					"chartheight": 300,
					"backgroundcolor": "#ffffff",
					"xaxistitle": "Memory Type",
					"yaxistitle": "Memory (KB)",
					"showxgridlines": true,
					"showygridlines": false
				};

				var seriesAttributes = {
					"type": "pie",
					"colorlist": "00ff00, 0000ff, gray",
					"serieslabel": "JVM Memory Distribution"
				};

				var chartDataItems = [
					{ "item": "Free Memory (KB)", "value": variables.testData.jvmFreeMemory },
					{ "item": "Used Memory (KB)", "value": variables.testData.jvmMaxMemory - variables.testData.jvmFreeMemory },
					{ "item": "Unallocated Memory (KB)", "value": variables.testData.jvmMaxMemory - variables.testData.jvmTotalMemory }
				];

				// Test chart component attributes
				expect( chartAttributes.xaxistitle ).toBe( "Memory Type" );
				expect( chartAttributes.yaxistitle ).toBe( "Memory (KB)" );
				expect( seriesAttributes.serieslabel ).toBe( "JVM Memory Distribution" );
				expect( arrayLen( chartDataItems ) ).toBe( 3 );
			} );

			it( "supports all new chart types", () => {
				var validChartTypes = [ "pie", "bar", "line", "doughnut", "radar", "polarArea", "area", "horizontalbar", "scatter", "bubble" ];

				// Test that all chart types are supported
				expect( arrayContains( validChartTypes, "area" ) ).toBeTrue( "Area charts should be supported" );
				expect( arrayContains( validChartTypes, "horizontalbar" ) ).toBeTrue( "Horizontal bar charts should be supported" );
				expect( arrayContains( validChartTypes, "scatter" ) ).toBeTrue( "Scatter plots should be supported" );
				expect( arrayContains( validChartTypes, "bubble" ) ).toBeTrue( "Bubble charts should be supported" );

				// Test original types still work
				expect( arrayContains( validChartTypes, "pie" ) ).toBeTrue( "Pie charts should still be supported" );
				expect( arrayContains( validChartTypes, "bar" ) ).toBeTrue( "Bar charts should still be supported" );
				expect( arrayContains( validChartTypes, "line" ) ).toBeTrue( "Line charts should still be supported" );
			} );

			it( "handles series placement configuration", () => {
				var seriesPlacementOptions = [ "default", "cluster", "stacked" ];

				// Test all placement options
				for ( var placement in seriesPlacementOptions ) {
					var chartConfig = {
						"seriesplacement": placement,
						"type": "bar"
					};

					// Verify placement option is valid
					expect( arrayContains( seriesPlacementOptions, placement ) ).toBeTrue( "Series placement '#placement#' should be valid" );
				}
			} );

			it( "processes color lists correctly", () => {
				var colorTests = [
					{ "input": "ff0000, 00ff00, 0000ff", "description": "Hex colors without # prefix" },
					{ "input": "#ff0000, #00ff00, #0000ff", "description": "Hex colors with # prefix" },
					{ "input": "##ff0000, ##00ff00, ##0000ff", "description": "Hex colors with ## prefix (BoxLang)" },
					{ "input": "red, green, blue", "description": "Named colors" }
				];

				for ( var colorTest in colorTests ) {
					var colorList = listToArray( colorTest.input );
					expect( arrayLen( colorList ) ).toBe( 3, "Color list should have 3 colors for: #colorTest.description#" );
				}
			} );

			it( "validates grid line configuration", () => {
				var gridLineConfig = {
					"showxgridlines": true,
					"showygridlines": false
				};

				// Test boolean grid line settings
				expect( isBoolean( gridLineConfig.showxgridlines ) ).toBeTrue( "X grid lines should be boolean" );
				expect( isBoolean( gridLineConfig.showygridlines ) ).toBeTrue( "Y grid lines should be boolean" );
				expect( gridLineConfig.showxgridlines ).toBeTrue( "X grid lines should be enabled" );
				expect( gridLineConfig.showygridlines ).toBeFalse( "Y grid lines should be disabled" );
			} );

			it( "supports comprehensive chart data structures", () => {
				var sampleChartData = [
					{ "item": "Q1 Sales", "value": 100000 },
					{ "item": "Q2 Sales", "value": 125000 },
					{ "item": "Q3 Sales", "value": 150000 },
					{ "item": "Q4 Sales", "value": 175000 }
				];

				// Test data structure
				for ( var dataPoint in sampleChartData ) {
					expect( structKeyExists( dataPoint, "item" ) ).toBeTrue( "Data point should have 'item' key" );
					expect( structKeyExists( dataPoint, "value" ) ).toBeTrue( "Data point should have 'value' key" );
					expect( len( dataPoint.item ) ).toBeGT( 0, "Item should not be empty" );
					expect( isNumeric( dataPoint.value ) ).toBeTrue( "Value should be numeric" );
				}
			} );

			it( "handles chart dimension configuration", () => {
				var dimensionTests = [
					{ "width": 400, "height": 300, "description": "Standard dimensions" },
					{ "width": 800, "height": 600, "description": "Large dimensions" },
					{ "width": 250, "height": 200, "description": "Small dimensions" }
				];

				for ( var test in dimensionTests ) {
					expect( test.width ).toBeGT( 0, "Width should be positive for: #test.description#" );
					expect( test.height ).toBeGT( 0, "Height should be positive for: #test.description#" );
					expect( isNumeric( test.width ) ).toBeTrue( "Width should be numeric for: #test.description#" );
					expect( isNumeric( test.height ) ).toBeTrue( "Height should be numeric for: #test.description#" );
				}
			} );

			it( "supports complex chart configurations", () => {
				var complexChartConfig = {
					"title": "Complex Performance Dashboard",
					"chartwidth": 600,
					"chartheight": 400,
					"backgroundcolor": "#f8f9fa",
					"showlegend": true,
					"show3d": false,
					"xaxistitle": "Time Period",
					"yaxistitle": "Performance Metrics",
					"showxgridlines": true,
					"showygridlines": true,
					"seriesplacement": "stacked"
				};

				// Validate complex configuration
				expect( len( complexChartConfig.title ) ).toBeGT( 0, "Title should not be empty" );
				expect( complexChartConfig.chartwidth ).toBeGT( 0, "Chart width should be positive" );
				expect( complexChartConfig.chartheight ).toBeGT( 0, "Chart height should be positive" );
				expect( isBoolean( complexChartConfig.showlegend ) ).toBeTrue( "Show legend should be boolean" );
				expect( len( complexChartConfig.xaxistitle ) ).toBeGT( 0, "X-axis title should not be empty" );
				expect( len( complexChartConfig.yaxistitle ) ).toBeGT( 0, "Y-axis title should not be empty" );
			} );

			it( "supports responsive chart configuration", () => {
				var responsiveConfig = {
					"responsive": true,
					"maintainAspectRatio": true,
					"aspectRatio": 2
				};

				// Test responsive configuration
				expect( isBoolean( responsiveConfig.responsive ) ).toBeTrue( "Responsive should be boolean" );
				expect( isBoolean( responsiveConfig.maintainAspectRatio ) ).toBeTrue( "MaintainAspectRatio should be boolean" );
				expect( isNumeric( responsiveConfig.aspectRatio ) ).toBeTrue( "AspectRatio should be numeric" );
				expect( responsiveConfig.aspectRatio ).toBeGT( 0, "AspectRatio should be positive" );
			} );

			it( "validates aspect ratio values", () => {
				var aspectRatioTests = [
					{ "ratio": 1, "description": "Square (1:1)" },
					{ "ratio": 2, "description": "Wide (2:1)" },
					{ "ratio": 3, "description": "Very wide (3:1)" },
					{ "ratio": 0.5, "description": "Tall (1:2)" }
				];

				for ( var test in aspectRatioTests ) {
					expect( test.ratio ).toBeGT( 0, "Aspect ratio should be positive for: #test.description#" );
					expect( isNumeric( test.ratio ) ).toBeTrue( "Aspect ratio should be numeric for: #test.description#" );
				}
			} );

			it( "handles responsive chart attributes correctly", () => {
				var chartAttributes = {
					"responsive": true,
					"maintainAspectRatio": false,
					"aspectRatio": 1.5,
					"chartwidth": 800,
					"chartheight": 400
				};

				// Validate attributes
				expect( chartAttributes.responsive ).toBeTrue( "Responsive should be enabled" );
				expect( chartAttributes.maintainAspectRatio ).toBeFalse( "MaintainAspectRatio should be disabled" );
				expect( chartAttributes.aspectRatio ).toBe( 1.5, "AspectRatio should be 1.5" );
				expect( chartAttributes.chartwidth ).toBe( 800, "Chart width should be 800" );
				expect( chartAttributes.chartheight ).toBe( 400, "Chart height should be 400" );
			} );

			it( "supports bubble chart data structure", () => {
				var bubbleChartData = [
					{ "item": "Data Point 1", "x": 10, "y": 20, "r": 5 },
					{ "item": "Data Point 2", "x": 15, "y": 25, "r": 8 },
					{ "item": "Data Point 3", "x": 20, "y": 30, "r": 12 }
				];

				// Test bubble data structure
				for ( var dataPoint in bubbleChartData ) {
					expect( structKeyExists( dataPoint, "item" ) ).toBeTrue( "Data point should have 'item' key" );
					expect( structKeyExists( dataPoint, "x" ) ).toBeTrue( "Data point should have 'x' key" );
					expect( structKeyExists( dataPoint, "y" ) ).toBeTrue( "Data point should have 'y' key" );
					expect( structKeyExists( dataPoint, "r" ) ).toBeTrue( "Data point should have 'r' key (radius)" );
					expect( isNumeric( dataPoint.x ) ).toBeTrue( "X coordinate should be numeric" );
					expect( isNumeric( dataPoint.y ) ).toBeTrue( "Y coordinate should be numeric" );
					expect( isNumeric( dataPoint.r ) ).toBeTrue( "Radius should be numeric" );
				}
			} );

			it( "supports resizeDelay attribute for performance optimization", () => {
				var chartAttributes = {
					"responsive": true,
					"resizeDelay": 100
				};

				// Validate resize delay
				expect( isNumeric( chartAttributes.resizeDelay ) ).toBeTrue( "ResizeDelay should be numeric" );
				expect( chartAttributes.resizeDelay ).toBeGTE( 0, "ResizeDelay should be non-negative" );
				expect( chartAttributes.resizeDelay ).toBe( 100, "ResizeDelay should be 100ms" );
			} );

		} );
	}

}