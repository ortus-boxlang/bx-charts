<bx:include template="includes/head.bxm">

<div class="container-fluid mt-4">
	<div class="row">
		<div class="col-12">
			<h1 class="display-4 mb-4">📊 Query-Based Charts</h1>
			<p class="lead">
				This page demonstrates using query data sources with charts, eliminating the need for manual chartData components.
			</p>
		</div>
	</div>

	<bx:script>
		// Create sample queries for testing

		// Query with default column names (item, value)
		salesQuery = queryNew(
			"item,value",
			"varchar,integer",
			[
				{ "item": "Product A", "value": 15000 },
				{ "item": "Product B", "value": 23000 },
				{ "item": "Product C", "value": 18000 },
				{ "item": "Product D", "value": 12000 },
				{ "item": "Product E", "value": 27000 }
			]
		);

		// Query with custom column names
		departmentQuery = queryNew(
			"department,budget",
			"varchar,integer",
			[
				{ "department": "Engineering", "budget": 850 },
				{ "department": "Marketing", "budget": 620 },
				{ "department": "Sales", "budget": 950 },
				{ "department": "HR", "budget": 340 },
				{ "department": "Operations", "budget": 720 }
			]
		);

		// Monthly data query
		monthlyQuery = queryNew(
			"month,revenue",
			"varchar,integer",
			[
				{ "month": "January", "revenue": 120000 },
				{ "month": "February", "revenue": 135000 },
				{ "month": "March", "revenue": 148000 },
				{ "month": "April", "revenue": 162000 },
				{ "month": "May", "revenue": 178000 },
				{ "month": "June", "revenue": 195000 }
			]
		);

		// Regional sales query
		regionalQuery = queryNew(
			"region,sales",
			"varchar,integer",
			[
				{ "region": "North America", "sales": 450 },
				{ "region": "Europe", "sales": 380 },
				{ "region": "Asia Pacific", "sales": 520 },
				{ "region": "Latin America", "sales": 210 },
				{ "region": "Middle East", "sales": 180 }
			]
		);

		// Performance metrics query
		metricsQuery = queryNew(
			"metric,count",
			"varchar,integer",
			[
				{ "metric": "Page Views", "count": 15420 },
				{ "metric": "Unique Visitors", "count": 8750 },
				{ "metric": "New Users", "count": 3240 },
				{ "metric": "Returning Users", "count": 5510 }
			]
		);
	</bx:script>

	<!-- Query with Default Column Names -->
	<div class="row mb-5">
		<div class="col-12">
			<div class="card shadow">
				<div class="card-header bg-primary text-white">
					<h3 class="mb-0">📈 Bar Chart with Query (Default Columns)</h3>
				</div>
				<div class="card-body">
					<p class="text-muted">
						Using query with default column names: <code>item</code> and <code>value</code>
					</p>
					<bx:chart title="Product Sales Revenue"
							  chartwidth="800" chartheight="400"
							  xaxistitle="Products" yaxistitle="Revenue ($)"
							  showygridlines="true"
							  backgroundcolor="##f8f9fa">
						<bx:chartseries type="bar" 
										query="#salesQuery#"
										colorlist="36A2EB"
										serieslabel="Sales Revenue">
						</bx:chartseries>
					</bx:chart>
				</div>
			</div>
		</div>
	</div>

	<!-- Query with Custom Column Names -->
	<div class="row mb-5">
		<div class="col-12">
			<div class="card shadow">
				<div class="card-header bg-success text-white">
					<h3 class="mb-0">🏢 Horizontal Bar Chart with Query (Custom Columns)</h3>
				</div>
				<div class="card-body">
					<p class="text-muted">
						Using query with custom column names: <code>department</code> and <code>budget</code>
					</p>
					<bx:chart title="Department Budgets ($1000s)"
							  chartwidth="800" chartheight="400"
							  xaxistitle="Budget" yaxistitle="Department"
							  showxgridlines="true">
						<bx:chartseries type="horizontalbar" 
										query="#departmentQuery#"
										itemColumn="department"
										valueColumn="budget"
										colorlist="FF6384,36A2EB,FFCE56,4BC0C0,9966FF"
										serieslabel="Budget Allocation">
						</bx:chartseries>
					</bx:chart>
				</div>
			</div>
		</div>
	</div>

	<!-- Line Chart with Query -->
	<div class="row mb-5">
		<div class="col-12">
			<div class="card shadow">
				<div class="card-header bg-info text-white">
					<h3 class="mb-0">📈 Line Chart with Query Data</h3>
				</div>
				<div class="card-body">
					<p class="text-muted">
						Monthly revenue trend using query data source
					</p>
					<bx:chart title="Monthly Revenue Trend"
							  chartwidth="800" chartheight="400"
							  xaxistitle="Month" yaxistitle="Revenue ($)"
							  showygridlines="true"
							  markersize="6">
						<bx:chartseries type="line" 
										query="#monthlyQuery#"
										itemColumn="month"
										valueColumn="revenue"
										colorlist="9966FF"
										serieslabel="Revenue">
						</bx:chartseries>
					</bx:chart>
				</div>
			</div>
		</div>
	</div>

	<!-- Pie Chart with Query -->
	<div class="row mb-5">
		<div class="col-12">
			<div class="card shadow">
				<div class="card-header bg-warning text-dark">
					<h3 class="mb-0">🥧 Pie Chart with Query Data</h3>
				</div>
				<div class="card-body">
					<p class="text-muted">
						Regional sales distribution using query
					</p>
					<div class="d-flex justify-content-center">
						<bx:chart title="Sales by Region"
								  chartwidth="600" chartheight="600"
								  showlegend="true">
							<bx:chartseries type="pie" 
											query="#regionalQuery#"
											itemColumn="region"
											valueColumn="sales"
											colorlist="FF6384,36A2EB,FFCE56,4BC0C0,9966FF"
											serieslabel="Regional Sales">
							</bx:chartseries>
						</bx:chart>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Doughnut Chart with Query -->
	<div class="row mb-5">
		<div class="col-12">
			<div class="card shadow">
				<div class="card-header bg-secondary text-white">
					<h3 class="mb-0">🍩 Doughnut Chart with Query Data</h3>
				</div>
				<div class="card-body">
					<p class="text-muted">
						Performance metrics visualization using query
					</p>
					<div class="d-flex justify-content-center">
						<bx:chart title="Website Performance Metrics"
								  chartwidth="600" chartheight="600"
								  showlegend="true"
								  backgroundcolor="##ffffff">
							<bx:chartseries type="doughnut" 
											query="#metricsQuery#"
											itemColumn="metric"
											valueColumn="count"
											colorlist="FF6384,36A2EB,FFCE56,4BC0C0"
											serieslabel="Metrics">
							</bx:chartseries>
						</bx:chart>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Area Chart with Query -->
	<div class="row mb-5">
		<div class="col-12">
			<div class="card shadow">
				<div class="card-header" style="background-color: ##6f42c1; color: white;">
					<h3 class="mb-0">🏔️ Area Chart with Query Data</h3>
				</div>
				<div class="card-body">
					<p class="text-muted">
						Revenue trend with filled area using query data
					</p>
					<bx:chart title="Revenue Growth Over Time"
							  chartwidth="800" chartheight="400"
							  xaxistitle="Month" yaxistitle="Revenue ($)"
							  showygridlines="true"
							  showxgridlines="false">
						<bx:chartseries type="area" 
										query="#monthlyQuery#"
										itemColumn="month"
										valueColumn="revenue"
										colorlist="6f42c1"
										serieslabel="Revenue Growth">
						</bx:chartseries>
					</bx:chart>
				</div>
			</div>
		</div>
	</div>

	<!-- Documentation -->
	<div class="row mb-5">
		<div class="col-12">
			<div class="card shadow">
				<div class="card-header bg-dark text-white">
					<h3 class="mb-0">📚 Using Queries with Charts</h3>
				</div>
				<div class="card-body">
					<h5>Benefits of Query-Based Charts</h5>
					<ul>
						<li>Eliminates need for manual <code>&lt;bx:chartdata&gt;</code> components</li>
						<li>Cleaner, more maintainable code</li>
						<li>Perfect for database-driven charts</li>
						<li>Reduces boilerplate code</li>
					</ul>

					<h5 class="mt-4">Query Requirements</h5>
					<ul>
						<li>Query must contain at least one record</li>
						<li><code>itemColumn</code> must exist in the query (defaults to "item")</li>
						<li><code>valueColumn</code> must exist in the query (defaults to "value")</li>
					</ul>

					<h5 class="mt-4">Usage Example</h5>
					<pre><code>&lt;bx:chartseries type="bar" 
                query="##myQuery##"
                itemColumn="category"
                valueColumn="amount"
                serieslabel="Sales Data"&gt;
&lt;/bx:chartseries&gt;</code></pre>

					<h5 class="mt-4">Default Column Names</h5>
					<p>If your query columns are named <code>item</code> and <code>value</code>, you don't need to specify column names:</p>
					<pre><code>&lt;bx:chartseries type="pie" query="##myQuery##"&gt;
&lt;/bx:chartseries&gt;</code></pre>
				</div>
			</div>
		</div>
	</div>
</div>

<bx:include template="includes/footer.bxm">
